import 'dart:convert';

import 'package:http/http.dart' as http;
import 'package:googleapis_auth/auth_io.dart' as auth;
class PushNotificationServices {
  Future<String> getAccessToken() async {
    final serviceAccountJson = {
      "type": "service_account",
      "project_id": "final-calling-pro",
      "private_key_id": "xxxxxxxxxxxxxxxxxxxxxxxxx",
      "private_key": "-----BEGIN PRIVATE KEY-----\xxxxxxxxxxxxrdRtVJtWuv9W\nyoiSEUZ0RzsdE/+Q+U/EyzMCgYEAy8fSv1JrErXpz+Im4ACprBSyIlVF7PlXqbCQ\n18Z4Kyhd7XGjqJoin+hLKD3PT6Ocvzs1FN69ejsYXy/mzdr/S+0xIIl58rG/i/6f\n7h4C+bb5Fa0vZ2APhrCSwKoGpwZD9rn2NVl5bYqvpiMHuRUA5iqWC+iptLZT6Ywt\nsvzW2qsCgYEAsMOEy45ZLDNmxpXMsQFKm9Idwt5V9IUR5cHQ7lSjqOSvYTchDRZm\nxs/tmoWYw36LlWAE+9esIWevtd6emuEUC5KNraz47ciCJItSUXHE4ipU+V+ms8O+\nlDmq8wUQGzrUnpW5vwl8PFuw2K8kJ5Yj+NbY8jywiFgK53F8/8+zb1cCgYBvkkZ2\n7f8lzWfoo9+5AWPkjahCWAHjD1nJ1JxZJ5cfughDOtbqNwoCF0MfE0hwSBpIMXiM\npq+DPtvHMgjiaKciwQkG0X5tPJitY4nY66Gha2bRUXME3Hlju0V+KxldVXbcnVCK\nQSTUrvwgsElIMpG9c0+X0ZkpEjK7Sj6zIu/X5QKBgQCb4kEZx21OBJBJFbB9ewWP\nUoBs62BoSX4XTlLW19+4Nwu+xA8bckrRKrcEuqkoQaO4ZIGKuZOtvi4Ax4Jjgro3\nadQ7eih+Wy7lf7IPIm6CYulSiFeRJ3bp42ywFFf5U0hJYs+J4eDoEk/0haoo8IyG\nCv9RK6/PUOtJ5wAANRoJTA==\n-----END PRIVATE KEY-----\n",
      "client_email": "firebase-adminsdk-fbsvc@final-calling-pro.iam.gserviceaccount.com",
      "client_id": "xxxxxxx",
      "auth_uri": "https://accounts.google.com/o/oauth2/auth",
      "token_uri": "https://oauth2.googleapis.com/token",
      "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
      "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-fbsvc%40final-calling-pro.iam.gserviceaccount.com",
      "universe_domain": "googleapis.com"
    }
    ;
    List<String> scopes = [
      "https://www.googleapis.com/auth/cloud-platform",
      "https://www.googleapis.com/auth/firebase.messaging"
    ];
    http.Client client = await auth.clientViaServiceAccount(
      auth.ServiceAccountCredentials.fromJson(serviceAccountJson),
      scopes,
    );
    auth.AccessCredentials credentials =
    await auth.obtainAccessCredentialsViaServiceAccount(
      auth.ServiceAccountCredentials.fromJson(serviceAccountJson),
      scopes,
      client,
    );
    client.close();
    print(
        "--------------------------------------------------------------------${credentials.accessToken.data}");
    return credentials.accessToken.data;
  }
  Future<void> sendFCMMessage(
      {required String title,
        required String body,
        required String fcm,
        required String type,/// "message","lead_share"
      }) async {
    final String serverKey = await getAccessToken();
    const String fcmEndpoint = 'https://fcm.googleapis.com/v1/projects/final-calling-pro/messages:send';
    final Map<String, dynamic> message = {
      'message': {
        'token': fcm,
        'notification': {'body': body, 'title': title},
        'data': {
          'type': type,
        },
      }
    };
    final http.Response response = await http.post(
      Uri.parse(fcmEndpoint),
      headers: <String, String>{
        'Content-Type': 'application/json',
        'Authorization': 'Bearer $serverKey',
      },
      body: jsonEncode(message),
    );
    if (response.statusCode == 200) {
      print('FCM message sent successfully');
    } else {
      print('Failed to send FCM message: ${response.statusCode}');
    }
  }
}
